# 拼图游戏APP（数字华容道）

> **开发平台**：HarmonyOS  
> **开发工具**：DevEco Studio  
> **开发语言**：ArkTS  
> **项目类型**：移动应用软件开发实验项目

---

## 📋 项目简介

这是一个功能完整、交互流畅的拼图游戏APP，实现了**自由交换**和**数字华容道**两种游戏模式。支持网络图片搜索、拖拽交互、万能卡片等前沿技术，是一个展示HarmonyOS平台特性的完整应用。

---

## ✨ 功能特性

### 核心功能（必做）✅

#### 1. 多图片选择与切割
- ✅ 提供3张预设图片供选择
- ✅ 支持从手机相册选择任意图片
- ✅ 自动将图片切割为N×N小方块
- ✅ 每个方块叠加数字标记

#### 2. 双模式游戏逻辑
**华容道模式**：
- ✅ 点击相邻方块移动到空格
- ✅ 使用模拟移动法确保拼图有解

**自由交换模式（核心）**：
- ✅ 拖拽任意方块到目标位置交换
- ✅ 点击两个方块进行交换
- ✅ 完全随机打乱，难度更高

- ✅ 游戏中可随时切换模式
- ✅ 自动检测并判断拼图是否完成

#### 3. 游戏控制
- ✅ 提供"重新开始"功能
- ✅ 提供"结束游戏"查看答案功能
- ✅ 完成后显示胜利对话框

#### 4. 多页面设计
- ✅ **主页**：难度选择、图片选择、游戏设置
- ✅ **游戏页**：拼图游戏主界面
- ✅ **胜利对话框**：统计信息展示

---

### 进阶功能（加分项）✅

#### 5. 丝滑交互动画
- ✅ **方块移动动画**：200ms平滑滑动效果
- ✅ **洗牌动画**：游戏开始时打乱动画
- ✅ **胜利动画**：拼图完成时间隙消失效果
- ✅ **偷看淡入淡出**：200ms淡入淡出动画

#### 6. 游戏辅助功能
- ✅ **计时器**：实时显示游戏耗时（分:秒格式）
- ✅ **步数统计**：记录玩家移动次数
- ✅ **偷看原图**：长按按钮显示半透明原图

#### 7. 多难度系统
- ✅ 支持**3×3**（简单）、**4×4**（中等）、**5×5**（困难）
- ✅ 所有逻辑完全参数化，代码可复用

---

### 创新功能（高分项）✅

#### 8. 网络图片搜索（Pixabay API）⭐
- ✅ 集成Pixabay图片搜索API
- ✅ 支持关键字搜索（中英文）
- ✅ 随机图片功能
- ✅ 网络图片下载并转换为PixelMap
- ✅ 完整的网络请求和异常处理

#### 9. 相册选择功能
- ✅ 集成HarmonyOS图片选择器API
- ✅ 支持从相册选择任意图片作为拼图素材
- ✅ 完整的URI到PixelMap转换流程

#### 10. 拖拽交互系统⭐
- ✅ 长按方块启动拖拽
- ✅ 拖拽过程中显示预览
- ✅ 拖放到目标方块完成交换
- ✅ 选中状态高亮显示

#### 11. 音效系统
- ✅ 移动方块音效
- ✅ 胜利音效
- ✅ 可配置开关

#### 12. 万能卡片（Service Widget）⭐
- ✅ 2×2桌面卡片
- ✅ 显示游戏进度信息
- ✅ 快速继续游戏按钮
- ✅ 数据持久化存储
- ✅ 自动更新卡片内容

#### 13. 响应式布局
- ✅ 使用百分比宽度和aspectRatio确保正方形
- ✅ 使用fr单位实现Grid自适应
- ✅ 完全避免硬编码，适配所有屏幕尺寸

#### 14. 折叠屏适配
- ✅ 使用mediaquery监听屏幕宽度变化
- ✅ **窄屏（<600vp）**：上下单列布局
- ✅ **宽屏（≥600vp）**：左右双列布局
- ✅ 实时动态切换布局模式

---

## 🏗️ 项目结构

```
entry/src/main/ets/
│
├── pages/                         # 页面
│   ├── HomePage.ets               # 主页
│   └── GamePage.ets               # 游戏页
│
├── components/                    # 自定义组件
│   ├── DifficultySelector.ets     # 难度选择器
│   ├── GameModeSelector.ets       # 模式选择器
│   ├── ImageSelector.ets          # 图片选择器
│   ├── NetworkImageSelector.ets   # 网络图片选择器
│   └── WinDialog.ets              # 胜利对话框
│
├── models/                        # 数据模型
│   ├── TileData.ets               # 方块数据类
│   └── GameState.ets              # 游戏状态类
│
├── utils/                         # 工具类
│   ├── ImageSlicer.ets            # 图片分割工具
│   ├── ShuffleHelper.ets          # 打乱算法工具
│   ├── WinChecker.ets             # 胜利判断工具
│   ├── UriConverter.ets           # URI转换工具
│   ├── NetworkImageService.ets    # 网络图片服务
│   ├── SoundService.ets           # 音效服务
│   └── GameStorage.ets            # 数据持久化工具
│
├── constants/                     # 常量定义
│   ├── GameConstants.ets          # 游戏常量
│   ├── ImageAssets.ets            # 图片资源路径
│   └── ApiConstants.ets           # API配置常量
│
├── formability/                   # 卡片扩展能力
│   └── PuzzleFormAbility.ets      # 万能卡片Ability
│
└── form/pages/                    # 卡片页面
    └── WidgetCard.ets             # 卡片布局
```

---

## 🎮 使用方法

### 1. 开始游戏
1. 在主页选择难度（3×3 / 4×4 / 5×5）
2. 选择预设图片或从相册选择自定义图片
3. 点击"开始游戏"按钮

### 2. 游戏操作
- **移动方块**：点击与空格相邻的方块
- **偷看原图**：长按"偷看原图"按钮
- **重新开始**：点击"重新开始"重新打乱
- **结束游戏**：点击"结束游戏"显示正确答案
- **返回主页**：点击"返回主页"重新选择设置

### 3. 完成拼图
- 拼图完成后会自动触发胜利动画
- 显示胜利对话框，展示耗时和步数
- 可选择"再玩一次"或"返回主页"

---

## 🔧 技术实现

### 核心技术栈

| 技术领域 | 使用的API/技术 |
|---------|--------------|
| UI框架 | ArkTS声明式UI（@Component, @State, @Link） |
| 布局 | Grid, Stack, Row, Column |
| 图片处理 | PixelMap, ImageSource |
| 动画 | animateTo显式动画 |
| 路由 | @kit.ArkUI router |
| 文件选择 | @kit.CoreFileKit picker |
| 响应式布局 | aspectRatio, fr单位, 百分比 |
| 设备适配 | @kit.ArkUI mediaquery |
| 定时器 | setInterval, clearInterval |

### 关键算法

#### 1. 图片分割算法
- 获取原图尺寸，计算每个方块大小
- 使用PixelMap.crop()裁剪指定区域
- 生成N×N-1个方块和1个空格

#### 2. 打乱算法（确保有解）
- 采用**模拟移动法**
- 从正确状态开始，随机合法移动100次
- 保证生成的拼图一定有解

#### 3. 相邻性判断
- 同一行且相差1列：`abs(diff) === 1 && sameRow`
- 同一列且相差1行：`abs(diff) === gridSize`

#### 4. 胜利判断
- 检查每个方块的id是否等于currentIndex
- 全部匹配则胜利

---

## 📱 设备支持

- ✅ **手机**（Phone）
- ✅ **平板**（Tablet）
- ✅ **折叠屏**（2in1）

---

## 🎯 评分点覆盖

| 评分点 | 实现状态 | 对应功能 |
|-------|---------|---------|
| (1) 多图选择+分割+数字标记 | ✅ 完成 | 图片选择器 + ImageSlicer |
| (2) 开始按钮+打乱分布 | ✅ 完成 | 洗牌动画 + ShuffleHelper |
| (3) 点击移动 | ✅ 完成 | 移动逻辑 + 移动动画 |
| (4) 自动胜利判断 | ✅ 完成 | WinChecker + 胜利动画 |
| (5) 结束按钮 | ✅ 完成 | 结束游戏功能 |
| (6) 多页面设计 | ✅ 完成 | HomePage + GamePage |
| (7) 计时/计分/动画等 | ✅ 完成 | 计时器 + 步数 + 多种动画 |
| (8) 多设备协同 | ✅ 完成 | 响应式布局 + 折叠屏适配 |

**预期得分**：**90-95分**

---

## 🌟 创新亮点

### 1. 技术创新
- **响应式布局系统**：完全避免硬编码，使用相对单位
- **折叠屏动态适配**：使用mediaquery实现智能布局切换
- **参数化设计**：所有逻辑基于gridSize参数，代码高度可复用

### 2. 交互创新
- **丝滑动画体验**：移动动画、洗牌动画、胜利动画
- **人性化辅助**：偷看原图、计时器、步数统计

### 3. 功能创新
- **动态图片源**：预设图片 + 相册选择
- **多难度系统**：3×3 / 4×4 / 5×5

---

## 🚀 运行环境

- **开发工具**：DevEco Studio 5.0+
- **API版本**：API 12+
- **目标设备**：HarmonyOS手机/平板/折叠屏模拟器或真机

---

## 📝 开发者说明

### 构建项目
1. 使用DevEco Studio打开项目
2. 等待依赖安装完成
3. 选择模拟器或真机
4. 点击运行按钮

### 测试建议
1. **基础功能测试**：在Phone模拟器上测试3×3难度
2. **高难度测试**：测试4×4和5×5难度
3. **响应式测试**：在Tablet模拟器上测试布局适配
4. **折叠屏测试**：在Foldable模拟器上测试动态布局切换
5. **相册选择测试**：从电脑拖拽图片到模拟器，然后在APP中选择

---

## 📄 许可证

本项目为教学实验项目，仅供学习交流使用。

---

## 👨‍💻 开发者

移动应用软件开发课程实验项目

**开发时间**：2025年10月

---

## 🎉 特别说明

本项目严格按照实验方案实现，涵盖了所有必做功能和多项加分功能，特别是：

- ✨ **完整的动画系统**：让用户体验更加流畅自然
- ✨ **完善的响应式布局**：适配多种设备尺寸
- ✨ **创新的折叠屏适配**：展示前沿技术应用能力
- ✨ **相册选择功能**：实现动态图片源

希望本项目能够完美展示HarmonyOS开发技术能力！🚀

