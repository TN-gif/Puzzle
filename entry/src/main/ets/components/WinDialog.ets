import { GameConstants } from '../constants/GameConstants';

/**
 * èƒœåˆ©å¯¹è¯æ¡†ç»„ä»¶
 */
@CustomDialog
export struct WinDialog {
  controller: CustomDialogController;
  moveCount: number = 0;
  timeElapsed: number = 0;
  onPlayAgain?: () => void;
  onBackHome?: () => void;

  // æ ¼å¼åŒ–æ—¶é—´
  private formatTime(seconds: number): string {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  }

  build() {
    Column({ space: 20 }) {
      // å¥–æ¯å›¾æ ‡
      Text('ðŸ†')
        .fontSize(64)

      // æ ‡é¢˜
      Text('æ­å–œå®Œæˆï¼')
        .fontSize(24)
        .fontWeight(FontWeight.Bold)
        .fontColor(GameConstants.COLORS.PRIMARY)

      // ç»Ÿè®¡ä¿¡æ¯
      Column({ space: 12 }) {
        Row() {
          Text('è€—æ—¶ï¼š')
            .fontSize(16)
            .fontColor(GameConstants.COLORS.TEXT)
          Text(this.formatTime(this.timeElapsed))
            .fontSize(20)
            .fontWeight(FontWeight.Bold)
            .fontColor(GameConstants.COLORS.PRIMARY)
        }

        Row() {
          Text('æ­¥æ•°ï¼š')
            .fontSize(16)
            .fontColor(GameConstants.COLORS.TEXT)
          Text(`${this.moveCount} æ­¥`)
            .fontSize(20)
            .fontWeight(FontWeight.Bold)
            .fontColor(GameConstants.COLORS.PRIMARY)
        }
      }
      .padding(16)
      .backgroundColor('#F5F5F5')
      .borderRadius(8)
      .width('100%')

      // æŒ‰é’®ç»„
      Column({ space: 12 }) {
        Button('å†çŽ©ä¸€æ¬¡')
          .width('100%')
          .height(44)
          .fontSize(16)
          .backgroundColor(GameConstants.COLORS.PRIMARY)
          .onClick(() => {
            this.controller.close();
            if (this.onPlayAgain) {
              this.onPlayAgain();
            }
          })

        Button('è¿”å›žä¸»é¡µ')
          .width('100%')
          .height(44)
          .fontSize(16)
          .backgroundColor(Color.White)
          .fontColor(GameConstants.COLORS.PRIMARY)
          .border({ width: 1, color: GameConstants.COLORS.PRIMARY })
          .onClick(() => {
            this.controller.close();
            if (this.onBackHome) {
              this.onBackHome();
            }
          })
      }
    }
    .padding(24)
    .backgroundColor(Color.White)
    .borderRadius(16)
  }
}

